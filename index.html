<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <title>HomeWorker</title>
        <style>
            * {
                font-family: sans-serif;
            }
            .topnav {
                overflow: hidden;
                background-color: #333;
                position: relative;
            }
              
            .topnav #links {
                display: none;
            }
              
            .topnav a {
                color: #ddd;
                padding: 14px 16px;
                text-decoration: none;
                font-size: 30px;
                display: block;
            }
            .topnav a.icon {
                background: #333;
                display: block;
                position: absolute;
                right: 0;
                top: 0;
            }
            .topnav a:hover {
                background-color: #ddd;
                color: #333;
            }
              
            .active {
                background-color: #333;
                color: #ddd;
            }

            .badge {
                background-color: red;
                color: #ddd;
                padding: 2px;
                text-align: center;
                border-radius: 5px;
            }
            .collapsible {
                background-color: #777;
                color: white;
                cursor: pointer;
                padding: 18px;
                width: 100%;
                border: none;
                text-align: left;
                outline: none;
                font-size: 15px;
            }
            .addbut {
                background-color: #777;
                color: white;
                cursor: pointer;
                padding: 18px;
                width: 100%;
                border: none;
                text-align: left;
                outline: none;
                font-size: 15px;
            }
              
            .active, .collapsible:hover, .addbut:hover {
                background-color: #555;
            } 
            .content {
                padding: 0 18px;
                display: none;
                overflow: hidden;
                background-color: #f1f1f1;
            }
            .header {
                font-size: x-large;
                padding: 2vmin;
                width: 100%;
            }
            .modal {
                display: none;
                position: fixed;
                z-index: 1;
                background-color: #ddd;
                color: #333;
                padding-top: 100px;
                left: 0;
                top: 0;
                width: 100%;
                height: 100%;
                overflow: auto;
                background-color: rgb(0, 0, 0);
                background-color: rgba(0, 0, 0, 0.4);
            }
            .modal-content {
                background-color: #fefefe;
                margin: auto;
                padding: 20px;
                border: 1px solid #888;
                width: 80%;
            }
            .close {
                color: #aaaaaa;
                float: right;
                font-size: 28px;
                font-weight: bold;
            }
            .close:hover,
            .close:focus {
                color: #000;
                text-decoration: none;
                cursor: pointer;
            }
            input, textarea {
                width: 100%;
            }
            .title{
                font-size: x-large;
            }
            .clearfix {
                overflow: auto;
            }
            .button {
                background-color: #333;
                color: #ddd;
                border-radius: 1vmin;
                padding: 3vmin;
            }
            .notif {
                padding: 4vmin;
                background-color: #ddd;
                color: #333;
                border-radius: 2vmin;
                margin-bottom: 3vmin;
            }
            .closenotif {
                margin-left: 3vmin;
                color: #333;
                font-weight: bold;
                float: right;
                font-size: 4vmin;
                line-height: 4vmin;
                cursor: pointer;
                transition: 0.3s;
            }
            .closenotif:hover {
                color: #777;
            }
            #search {
                font-size: 3vmin;
                height: 4vmin;
                width: 75%;
            }
            #searchbut {
                padding: .5vmin;
                font-size: 3vmin;
                width: 20%;
            }
            .delbutton {
                padding: 1vmin;
                margin: 1vmin;
                float: right;
                background-color: red;
                color: white;
            }
            .editbutton {
                padding: 1vmin;
                margin: 1vmin;
                float: right;
                background-color: #555;
                color: white;
            }
            .clearbutton {
                padding: 1vmin;
                margin: 1vmin;
                font-size: x-large;
                background-color: red;
                color: white;
            }
        </style>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
        <script>
            class user{
                constructor(){
                    this.assignments = [];
                    this.notifications = [];
                    this.original;
                }
            }

            class assignment{
                constructor(name, description, due){
                    this.name = name;
                    this.description = description;
                    this.due = due;
                }

                gethtml(n){
                    return `
                    <button type="button" class="collapsible">${this.name}<span class="clearfix" style="float: right;">${this.due.toLocaleString()}</span></button>
                    <div class="content">
                        <p>${this.description}</p>
                        <button class="button delbutton" onclick="delassignment(${n});">Delete Assignment</button><button class="button editbutton" onclick="editassignment(${n});">Edit Assignment</button>
                    </div>
                    `
                }
            }

            class notification{
                constructor(data, actions){
                    this.data = data;
                    this.actions = actions;
                }

                gethtml(n){
                    var acthtml = "";
                    for(var act of this.actions){
                        acthtml += `<span>[<a style="color: blue; text-decoration: underline; cursor: pointer;" onclick='${act[1]}delnotif(${n});'>${act[0]}</a>]</span>`
                        return `
                            <div class="notif">
                                <span class="closenotif" onclick="delnotif(${n});">&times;</span>
                                ${this.data}
                                <br>
                                ${acthtml}                            
                            </div>
                        `
                    }
                }
            }

            function showassign(){
                document.getElementById("searchcont").style.display = "none";
                document.getElementById("notifcont").style.display = "none";
                document.getElementById("assignmentcont").style.display = "block";
                document.getElementById("duesooncont").style.display = "none";
                toggleLinks();
            }

            function shownotif(){
                document.getElementById("searchcont").style.display = "none";
                document.getElementById("assignmentcont").style.display = "none";
                document.getElementById("notifcont").style.display = "block";
                document.getElementById("duesooncont").style.display = "none";
                toggleLinks();
            }

            function showsearch(){
                document.getElementById("notifcont").style.display = "none";
                document.getElementById("assignmentcont").style.display = "none";
                document.getElementById("searchcont").style.display = "block";
                document.getElementById("duesooncont").style.display = "none";
                toggleLinks();
            }

            function showduesoon(){
                document.getElementById("notifcont").style.display = "none";
                document.getElementById("assignmentcont").style.display = "none";
                document.getElementById("searchcont").style.display = "none";
                document.getElementById("duesooncont").style.display = "block";
                loadduesoon();
                toggleLinks();
            }

            function toggleLinks(){
                if(document.getElementById("links").style.display == "block"){
                    document.getElementById("links").style.display = "none";
                }else{
                    document.getElementById("links").style.display = "block";
                }
            }

            function addassignment(){
                nassignment = new assignment(document.getElementById("titlein").value, document.getElementById("descin").value, new Date(document.getElementById("duein").value));
                document.getElementById("assignments").innerHTML += nassignment.gethtml(curuser.assignments.length);
                curuser.assignments.push(nassignment);
                var namodal = document.getElementById("namodal");
                namodal.style.display = "none";
                drawassignments();
                loadduesoon();
            }

            function addassignobj(aobj){
                var nobj = JSON.parse(unescape(aobj))
                var nassign = new assignment(nobj.name, nobj.description, new Date(nobj.due));
                curuser.assignments.push(nassign);
                drawassignments();
                loadduesoon();
            }

            function drawnotifs(){
                document.getElementById("notifs").innerHTML = "";
                for(var i = 0; i<curuser.notifications.length; i++){
                    var notif = curuser.notifications[i];
                    document.getElementById("notifs").innerHTML += notif.gethtml(i);
                }
                document.getElementById("notenum").style.display = "inline-block";
                document.getElementById("notenum").innerHTML = curuser.notifications.length;
                if(document.getElementById("notenum").innerHTML <= 0){
                    document.getElementById("notenum").style.display = "none";
                }
            }

            function delnotif(n){
                curuser.notifications.splice(n, 1);
                drawnotifs();
            }

            function delassignment(n){
                var del = curuser.assignments[n];
                curuser.assignments.splice(n, 1)
                var note = new notification(`Assignment "${del.name}" deleted.`, [["undo", `addassignobj("${escape(JSON.stringify(del))}");`]]);
                curuser.notifications.push(note);
                drawnotifs();
                drawassignments();
                loadduesoon();
            }

            function editassignment(n){
                var original = curuser.assignments[n];
                curuser.assignments.splice(n, 1)
                curuser.original = original;
                original.due.setMinutes(original.due.getMinutes() - original.due.getTimezoneOffset());
                document.getElementById('duee').value = original.due.toISOString().slice(0,16);
                document.getElementById("emodal").style.display = "block";
                document.getElementById("titlee").value = original.name;
                document.getElementById("desce").value = original.description;
                drawassignments();
            }

            function finedit(){
                nassign = new assignment(document.getElementById("titlee").value, document.getElementById("desce").value, new Date(document.getElementById('duee').value));
                curuser.assignments.push(nassign);
                document.getElementById("emodal").style.display = "none";
                drawassignments();
                loadduesoon();
            }

            function revert(){
                nassign = new assignment(curuser.original.name, curuser.original.description, new Date(curuser.original.due));
                curuser.assignments.push(nassign);
                document.getElementById("emodal").style.display = "none";
                drawassignments();
                loadduesoon();
            }

            function drawassignments(){
                document.getElementById("assignments").innerHTML = "";
                for(var i = 0; i<curuser.assignments.length; i++){
                    var assign = curuser.assignments[i];
                    document.getElementById("assignments").innerHTML += assign.gethtml(i);
                }
            }

            function namodal(){
                document.getElementById('namodal').style.display='block';
                var now = new Date();
                now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
                document.getElementById('duein').value = now.toISOString().slice(0,16);
                document.getElementById("titlein").value = "";
                document.getElementById("descin").value = "";
                document.getElementById("addin").innerHTML = "Add";
            }

            function loadduesoon(){
                var now = new Date();
                now = addDays(2, now)
                var duesoon = 0;
                document.getElementById("duesoon").innerHTML = "";
                for(var j=0; j<curuser.assignments.length; j++){
                    var assign = curuser.assignments[j];
                    if(assign.due < now){
                        duesoon++;
                        document.getElementById("duesoon").innerHTML += assign.gethtml(j);
                    }
                }
                if(duesoon > 0){
                    document.getElementById("dsnum").style.display = "inline-block";
                    document.getElementById("dsnum").innerHTML = duesoon;
                }else{
                    document.getElementById("dsnum").style.display = "none";
                }

                var coll = document.getElementsByClassName("collapsible");
                for (var i = 0; i < coll.length; i++) {
                    coll[i].addEventListener("click", function() {
                        this.classList.toggle("active");
                        var content = this.nextElementSibling;
                        if (content.style.display === "block") {
                            content.style.display = "none";
                        } else {
                            content.style.display = "block";
                        }
                    });
                }
                console.log("done!")
            }

            function addDays(numOfDays, date=new Date()) {
                rdate = new Date();
                rdate.setTime(date.getTime() + numOfDays * 24 * 60 * 60 * 1000);
                return rdate;
            }

            function load(){ 
                var namodal = document.getElementById("namodal");
                var naspan = document.getElementsByClassName("close")[0];
                naspan.onclick = function () {
                    namodal.style.display = "none";
                }
                window.onclick = function (event) {
                    if (event.target == namodal) {
                        namodal.style.display = "none";
                    }
                }

                var coll = document.getElementsByClassName("collapsible");
                for (var i = 0; i < coll.length; i++) {
                    coll[i].addEventListener("click", function() {
                        this.classList.toggle("active");
                        var content = this.nextElementSibling;
                        if (content.style.display === "block") {
                            content.style.display = "none";
                        } else {
                            content.style.display = "block";
                        }
                    });
                }

                curuser = new user();

                document.getElementById("notenum").style.display = "none";
                showassign();
                toggleLinks();
            }
        </script>
    </head>
    <body>
        <div class="topnav">
        <a onclick="showassign(); toggleLinks();" class="active">HomeWorker</a>
        <div id="links">
            <a onclick="showassign();"><i class="fa fa-file-text"></i> Assignments</a>
            <a onclick="showduesoon();"><i class="fa fa-clock-o"></i> Due Soon <span class="badge" id="dsnum">0</span></a>
            <a onclick="shownotif();"><i class="fa fa-bell"></i> Notifications <span class="badge" id="notenum">0</span></a>
            <a onclick="showsearch();"><i class="fa fa-search"></i> Search</a>
        </div>
        <a class="icon" onclick="toggleLinks();">
            <i class="fa fa-bars"></i>
        </a>
        </div>
        <div id="assignmentcont">
            <div class="header">
                <span>My Assignments:</span>
            </div>
            <div id="assignments">

            </div>
            <button class="addbut" onclick="namodal();">Add Assignment</button>
        </div>
        <div id="notifcont">
            <div class="header">
                <span>Notifications:</span>
            </div>
            <div id="notifs">
            </div>
            <button class="clearbutton" onclick="document.getElementById('clrmodal').style.display='block'">Clear All</button>
        </div>
        <div id="searchcont">
            <div id="searchbar">
                <br>
                <input type="text" placeholder="Search..." id="search">
                <button id="searchbut"><i class="fa fa-search"></i></button>
                <br>
                <br>
                <button type="button" class="collapsible">Filters</button>
                <div class="content">
                    <h1>Filters...</h1>
                </div>
            </div>
        </div>
        <div id="duesooncont">
            <div class="header">
                <span>Due Soon:</span>
            </div>
            <div id="duesoon">

            </div>
        </div>
        <div id="namodal" class="modal">
            <div class="modal-content clearfix">
                <span class="title">Add Assignment:</span>
                <span class="close">&times;</span>
                <br>
                <br>
                <form>
                    <span>Title:</span>
                    <br>
                    <input id="titlein" type="text" placeholder="Title...">
                    <br>
                    <br>
                    <span>Description:</span>
                    <br>
                    <textarea id="descin" placeholder="Description..."></textarea>
                    <br>
                    <br>
                    <span>Due:</span>
                    <br>
                    <input id="duein" type="datetime-local">
                </form>
                <button id="addin" onclick="addassignment();" class="button" style="float: right; margin-top: 1vmin;">Add</button>
            </div>
        </div>
        <div id="emodal" class="modal">
            <div class="modal-content clearfix">
                <span class="title">Edit Assignment:</span>
                <span class="close" onclick="revert();">&times;</span>
                <br>
                <br>
                <form>
                    <span>Title:</span>
                    <br>
                    <input id="titlee" type="text" placeholder="Title...">
                    <br>
                    <br>
                    <span>Description:</span>
                    <br>
                    <textarea id="desce" placeholder="Description..."></textarea>
                    <br>
                    <br>
                    <span>Due:</span>
                    <br>
                    <input id="duee" type="datetime-local">
                </form>
                <button id="addin" onclick="finedit();" class="button" style="float: right; margin-top: 1vmin;">Edit</button><button id="addin" onclick="revert();" class="button" style="float: right; margin-top: 1vmin;">Cancel</button>
            </div>
        </div>
        <div id="clrmodal" class="modal">
            <div class="modal-content clearfix">
                <span class="close" onclick="this.parentElement.parentElement.style.display = 'none';">&times;</span>
                <blockquote>
                    Are you sure you want to clear all notifications? This action can't be undone.
                </blockquote>
                <button class="delbutton" style="color: #333; background-color: #ddd;" onclick="this.parentElement.parentElement.style.display = 'none';">Let's not do that</button>
                <button class="delbutton" onclick="curuser.notifications=[]; drawnotifs(); this.parentElement.parentElement.style.display = 'none';">Yes, I'm Sure.</button>
            </div>
        </div>
        <script>load();</script>
    </body>
</html>